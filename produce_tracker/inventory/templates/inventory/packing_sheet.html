{% extends "inventory/base.html" %}
{% load static %}

{% block title %}Packing Sheet{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Packing Sheet</h2>
    <div class="btn-group">
        <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown">
            Filter by Date
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'packing-sheet' %}">All Pending</a></li>
            <li><hr class="dropdown-divider"></li>
            {% for date in upcoming_dates %}
            <li><a class="dropdown-item" href="{% url 'packing-sheet-date' date|date:'Y-m-d' %}">{{ date|date:"M d, Y" }}</a></li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <h4>{% if delivery_date %}{{ delivery_date|date:"l, M d, Y" }}{% else %}All Pending Orders{% endif %}</h4>
    </div>
    <div class="card-body">
        {% if orders %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Order #</th>
                        <th>Customer</th>
                        <th>Delivery Date</th>
                        <th>Items</th>
                        <th>Total Weight</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>{{ order.id }}</td>
                        <td>{{ order.customer.company_name }}</td>
                        <td>{{ order.delivery_date|date:"M d, Y" }}</td>
                        <td>
                            {% for item in order.orderitem_set.all %}
                            {{ item.product.get_name_display }} Ã— {{ item.quantity }}<br>
                            {% endfor %}
                        </td>
                        <td>{{ order.total_weight }}kg</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No orders found for this date.</p>
        {% endif %}
    </div>
</div>

{% if packing_data %}
<div class="card">
    <div class="card-header">
        <h4>Packing Summary</h4>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Total Weight</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in packing_data %}
                    <tr>
                        <td>{{ item.product.get_name_display }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.total_weight }}kg</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <th>Total</th>
                        <th>{{ total_quantity }}</th>
                        <th>{{ total_weight }}kg</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}